{"ast":null,"code":"import React,{useCallback,useEffect,useState}from\"react\";import{useLocation,useNavigate,useParams}from\"react-router-dom\";import ApiService from\"../services/ApiService\";import{Box,Button,Container,Grid,Modal,TextField,Typography}from\"@mui/material\";import{useDispatch}from\"react-redux\";import{deletePost}from\"../store/slices/postSlice\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const PostDetail=()=>{const{id}=useParams();const[post,setPost]=useState(null);const[password,setPassword]=useState(\"\");const[showModal,setShowModal]=useState(false);const[actionType,setActionType]=useState(\"\");// \"edit\" 또는 \"delete\"\nconst[errorMessage,setErrorMessage]=useState(\"\");const location=useLocation();// 비밀번호 상태 가져오기\nconst navigate=useNavigate();const dispatch=useDispatch();// 모달 스타일\nconst modalStyle={position:\"absolute\",top:\"50%\",left:\"50%\",transform:\"translate(-50%, -50%)\",width:400,bgcolor:\"background.paper\",borderRadius:2,boxShadow:24,p:4};//게시글 상세 정보 가져오기\nconst fetchPostDetails=useCallback(async password=>{try{const response=await ApiService.fetchPostDetails(id,password);setPost(response.data);}catch(error){setErrorMessage(\"Error fetching post details\");console.error(\"Error fetching post details: \",error);}},[id]);//게시글 불러오기\nuseEffect(()=>{if(location.state&&location.state.password&&id){fetchPostDetails(location.state.password);}},[id,location.state,fetchPostDetails]);// 수정/삭제 버튼 클릭 시 모달 열기\nconst handleActionClick=type=>{setActionType(type);setShowModal(true);//모달창 표시\n};const handlePasswordChange=e=>{setPassword(e.target.value);};// 모달에서 확인버튼 눌렀을 때 처리\nconst handleSubmit=async()=>{setErrorMessage(\"\");try{//삭제\nif(actionType===\"delete\"){// await ApiService.deletePost(id, password);\n// navigate(`/board/${post.board_id}`); // 삭제 후 게시글 목록으로 이동\nconst resultAction=await dispatch(deletePost({postId:id,password}));if(deletePost.fulfilled.match(resultAction)){navigate(\"/posts\");// 삭제 후 게시글 목록으로 이동\n}else{setErrorMessage(\"삭제에 실패했습니다. 다시 시도해주세요.\");}}//수정\nelse if(actionType===\"edit\"){// 수정 페이지로 이동 (비밀번호와 boardId를 상태로 전달)\nnavigate(`/edit-post/${id}`,{state:{password}});}}catch(error){console.error(\"Error deleting or editing post: \",error);}};if(!post)return/*#__PURE__*/_jsx(\"div\",{children:\"Loading...\"});return/*#__PURE__*/_jsxs(Container,{children:[/*#__PURE__*/_jsx(Typography,{variant:\"h4\",gutterBottom:true,children:post.title}),/*#__PURE__*/_jsxs(Typography,{variant:\"body1\",children:[\"\\uC791\\uC131\\uC790: \",post.user_name,\" \"]}),/*#__PURE__*/_jsxs(Typography,{variant:\"body1\",children:[\"\\uC791\\uC131\\uC77C: \",new Date(post.posted_at).toLocaleDateString()]}),/*#__PURE__*/_jsxs(Typography,{variant:\"body2\",children:[\" \",post.content,\" \"]}),/*#__PURE__*/_jsxs(Grid,{container:true,spacing:2,children:[/*#__PURE__*/_jsx(Grid,{item:true,children:/*#__PURE__*/_jsx(Button,{onClick:()=>{handleActionClick(\"edit\");},children:\"\\uC218\\uC815\\uD558\\uAE30\"})}),/*#__PURE__*/_jsx(Grid,{item:true,children:/*#__PURE__*/_jsx(Button,{onClick:()=>{handleActionClick(\"delete\");},children:\"\\uC0AD\\uC81C\\uD558\\uAE30\"})}),/*#__PURE__*/_jsx(Grid,{item:true,children:/*#__PURE__*/_jsxs(Button,{variant:\"outlined\",onClick:()=>navigate(`/board/${post.board_id}`),children:[\"\\uBAA9\\uB85D\\uC73C\\uB85C \\uAC00\\uAE30 \",location.state.boardId]})})]}),/*#__PURE__*/_jsx(Modal,{open:showModal,onClose:()=>setShowModal(false),children:/*#__PURE__*/_jsxs(Box,{sx:modalStyle,children:[/*#__PURE__*/_jsx(Typography,{variant:\"h6\",gutterBottom:true,children:\"\\uBE44\\uBC00\\uBC88\\uD638\\uB97C \\uC785\\uB825\\uD558\\uC138\\uC694\"}),/*#__PURE__*/_jsx(TextField,{type:\"password\",label:\"\\uBE44\\uBC00\\uBC88\\uD638\",fullWidth:true,value:password,onChange:handlePasswordChange,error:!!errorMessage,helperText:errorMessage}),/*#__PURE__*/_jsxs(Box,{sx:{mt:2,display:\"flex\",justifyContent:\"space-between\"},children:[/*#__PURE__*/_jsx(Button,{variant:\"contained\",color:\"primary\",onClick:handleSubmit,children:\"\\uD655\\uC778\"}),/*#__PURE__*/_jsx(Button,{variant:\"contained\",color:\"primary\",onClick:()=>setShowModal(false),children:\"\\uCDE8\\uC18C\"})]})]})})]});};export default PostDetail;","map":{"version":3,"names":["React","useCallback","useEffect","useState","useLocation","useNavigate","useParams","ApiService","Box","Button","Container","Grid","Modal","TextField","Typography","useDispatch","deletePost","jsx","_jsx","jsxs","_jsxs","PostDetail","id","post","setPost","password","setPassword","showModal","setShowModal","actionType","setActionType","errorMessage","setErrorMessage","location","navigate","dispatch","modalStyle","position","top","left","transform","width","bgcolor","borderRadius","boxShadow","p","fetchPostDetails","response","data","error","console","state","handleActionClick","type","handlePasswordChange","e","target","value","handleSubmit","resultAction","postId","fulfilled","match","children","variant","gutterBottom","title","user_name","Date","posted_at","toLocaleDateString","content","container","spacing","item","onClick","board_id","boardId","open","onClose","sx","label","fullWidth","onChange","helperText","mt","display","justifyContent","color"],"sources":["C:/workspace/github_test/react-myboard-app/src/components/PostDetail.js"],"sourcesContent":["import React, { useCallback, useEffect, useState } from \"react\";\nimport { useLocation, useNavigate, useParams } from \"react-router-dom\";\nimport ApiService from \"../services/ApiService\";\nimport {\n  Box,\n  Button,\n  Container,\n  Grid,\n  Modal,\n  TextField,\n  Typography,\n} from \"@mui/material\";\nimport { useDispatch } from \"react-redux\";\nimport { deletePost } from \"../store/slices/postSlice\";\n\nconst PostDetail = () => {\n  const { id } = useParams();\n  const [post, setPost] = useState(null);\n  const [password, setPassword] = useState(\"\");\n  const [showModal, setShowModal] = useState(false);\n  const [actionType, setActionType] = useState(\"\"); // \"edit\" 또는 \"delete\"\n  const [errorMessage, setErrorMessage] = useState(\"\");\n  const location = useLocation(); // 비밀번호 상태 가져오기\n  const navigate = useNavigate();\n  const dispatch = useDispatch();\n\n  // 모달 스타일\n  const modalStyle = {\n    position: \"absolute\",\n    top: \"50%\",\n    left: \"50%\",\n    transform: \"translate(-50%, -50%)\",\n    width: 400,\n    bgcolor: \"background.paper\",\n    borderRadius: 2,\n    boxShadow: 24,\n    p: 4,\n  };\n\n  //게시글 상세 정보 가져오기\n  const fetchPostDetails = useCallback(\n    async (password) => {\n      try {\n        const response = await ApiService.fetchPostDetails(id, password);\n        setPost(response.data);\n      } catch (error) {\n        setErrorMessage(\"Error fetching post details\");\n        console.error(\"Error fetching post details: \", error);\n      }\n    },\n    [id]\n  );\n\n  //게시글 불러오기\n  useEffect(() => {\n    if (location.state && location.state.password && id) {\n      fetchPostDetails(location.state.password);\n    }\n  }, [id, location.state, fetchPostDetails]);\n\n  // 수정/삭제 버튼 클릭 시 모달 열기\n  const handleActionClick = (type) => {\n    setActionType(type);\n    setShowModal(true); //모달창 표시\n  };\n\n  const handlePasswordChange = (e) => {\n    setPassword(e.target.value);\n  };\n\n  // 모달에서 확인버튼 눌렀을 때 처리\n  const handleSubmit = async () => {\n    setErrorMessage(\"\");\n    try {\n      //삭제\n      if (actionType === \"delete\") {\n        // await ApiService.deletePost(id, password);\n        // navigate(`/board/${post.board_id}`); // 삭제 후 게시글 목록으로 이동\n        const resultAction = await dispatch(\n          deletePost({ postId: id, password })\n        );\n        if (deletePost.fulfilled.match(resultAction)) {\n          navigate(\"/posts\"); // 삭제 후 게시글 목록으로 이동\n        } else {\n          setErrorMessage(\"삭제에 실패했습니다. 다시 시도해주세요.\");\n        }\n      }\n      //수정\n      else if (actionType === \"edit\") {\n        // 수정 페이지로 이동 (비밀번호와 boardId를 상태로 전달)\n        navigate(`/edit-post/${id}`, {\n          state: { password },\n        });\n      }\n    } catch (error) {\n      console.error(\"Error deleting or editing post: \", error);\n    }\n  };\n\n  if (!post) return <div>Loading...</div>;\n\n  return (\n    <Container>\n      <Typography variant=\"h4\" gutterBottom>\n        {post.title}\n      </Typography>\n      <Typography variant=\"body1\">작성자: {post.user_name} </Typography>\n      <Typography variant=\"body1\">\n        작성일: {new Date(post.posted_at).toLocaleDateString()}\n      </Typography>\n      <Typography variant=\"body2\"> {post.content} </Typography>\n\n      <Grid container spacing={2}>\n        <Grid item>\n          <Button\n            onClick={() => {\n              handleActionClick(\"edit\");\n            }}\n          >\n            수정하기\n          </Button>\n        </Grid>\n        <Grid item>\n          <Button\n            onClick={() => {\n              handleActionClick(\"delete\");\n            }}\n          >\n            삭제하기\n          </Button>\n        </Grid>\n        <Grid item>\n          <Button\n            variant=\"outlined\"\n            onClick={() => navigate(`/board/${post.board_id}`)}\n          >\n            목록으로 가기 {location.state.boardId}\n          </Button>\n        </Grid>\n      </Grid>\n\n      <Modal open={showModal} onClose={() => setShowModal(false)}>\n        <Box sx={modalStyle}>\n          <Typography variant=\"h6\" gutterBottom>\n            비밀번호를 입력하세요\n          </Typography>\n          <TextField\n            type=\"password\"\n            label=\"비밀번호\"\n            fullWidth\n            value={password}\n            onChange={handlePasswordChange}\n            error={!!errorMessage}\n            helperText={errorMessage}\n          />\n          <Box sx={{ mt: 2, display: \"flex\", justifyContent: \"space-between\" }}>\n            <Button variant=\"contained\" color=\"primary\" onClick={handleSubmit}>\n              확인\n            </Button>\n            <Button\n              variant=\"contained\"\n              color=\"primary\"\n              onClick={() => setShowModal(false)}\n            >\n              취소\n            </Button>\n          </Box>\n        </Box>\n      </Modal>\n    </Container>\n  );\n};\n\nexport default PostDetail;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}